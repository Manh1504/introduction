<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <link rel="stylesheet" href="../navbar/navbar.css">
        <link rel="stylesheet" href="../navbar/style.css">
        <link rel="stylesheet" href="../navbar/universal.css">
        <style>
            body {
                background-color: #0D0D0D;
                color: #FFFFFF;
                font-family: 'Poppins', sans-serif;
                margin: 0;
                padding-top: 80px;
            }
            .order {
                border: 1px solid #ccc;
                padding: 15px;
                margin-bottom: 15px;
                border-radius: 8px;
                background-color: #f9f9f9;
            }
            .item {
                padding-left: 20px;
            }
        </style>
    </head>
    <body>
    <header>
        <nav style="position: fixed; top: 0; width: 100%;">
            <div class="nav-bar">
                <li class="logo">
                </li>
                <span class="menu font-sans">
                    <li>
                        <a href="../index-background.html" class="text-white text-center" href="#home">Home</a>
                      </li>
                    <li>
                      <a class="text-white text-center" href="../Course/Course.html">Courses</a>
                    </li>
                    <li><a class="text-white text-center" id="contact-link" href="../Contact/contact.html">Contact Us</a></li>
                    <li>
                      <a class="text-white text-center" style="color:#AF4A92" href="../About Us/AboutUs.html">About Us</a>
                    </li>
                     <li id="userArea">
                        <a href="../html/login.html" id="loginLink">
                            <button class="btn-design text-bold">Login</button>
                        </a>
                    </li>
                    <label for="check" class="close-menu">
                      <i class="text-white fas fa-times"></i>
                    </label>
                  </span>

            </div>

            <label for="check" class="open-menu">
                <i class="text-white fas fa-bars"></i>
            </label>
            </div>
        </nav>
    </header>
    <h1>Lịch sử mua hàng</h1>
    <div id="order-history">Đang tải...</div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCn9oE0KbfTnp5JD8VhuXW-y78xUFH-iRg",
            authDomain: "bai-tap-html.firebaseapp.com",
            databaseURL: "https://bai-tap-html-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "bai-tap-html",
            storageBucket: "bai-tap-html.appspot.com",
            messagingSenderId: "1825688805",
            appId: "1:1825688805:web:0fea5be7f1db7f0339580c",
            measurementId: "G-0QC28N9X9M"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        function loadPurchaseHistory() {
            const username = localStorage.getItem("currentUsername"); // Ví dụ: "kieu"
            const container = document.getElementById("order-history");

            if (!username) {
                container.innerHTML = "Không tìm thấy tên người dùng. Hãy đăng nhập trước.";
                return;
            }

            const ordersRef = ref(db, `orders/${username}`);
            get(ordersRef)
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const orders = snapshot.val();
                        displayOrders(orders);
                    } else {
                        container.innerHTML = "Bạn chưa có đơn hàng nào.";
                    }
                })
                .catch(error => {
                    console.error(error);
                    container.innerHTML = "Đã xảy ra lỗi khi lấy dữ liệu.";
                });
        }

        function displayOrders(orders) {
            const container = document.getElementById("order-history");
            container.innerHTML = "";

            Object.values(orders).forEach(order => {
                const orderDiv = document.createElement("div");
                orderDiv.className = "order";

                let itemsHTML = "";
                if (order.items && Array.isArray(order.items)) {
                    order.items.forEach((item, index) => {
                        itemsHTML += `<div class="item">#${index + 1}: ${JSON.stringify(item)}</div>`;
                    });
                }

                orderDiv.innerHTML = `
                    <p><strong>Ngày đặt:</strong> ${order.date}</p>
                    <p><strong>ID đơn hàng:</strong> ${order.orderId}</p>
                    <p><strong>Người đặt:</strong> ${order.user}</p>
                    <div><strong>Sản phẩm:</strong>${itemsHTML || "Không có sản phẩm nào"}</div>
                `;

                container.appendChild(orderDiv);
            });
        }

        window.onload = loadPurchaseHistory;
    </script>
    <script src="../js/profile.js"></script>
    </body>
</html>
